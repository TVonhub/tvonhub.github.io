<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏¢‡∏≠‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏î ‚Äî Active Users</title>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-database-compat.js"></script>

  <style>
    :root{
      --bg1:#0f172a; --bg2:#0b1220; --card:#0f172a;
      --muted:#9aa7bd;
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
      font-family:Inter,system-ui,Roboto,Arial;color:#e6eef8;
      overflow:hidden;
    }
    canvas#fireworks{
      position:fixed;inset:0;
      width:100%;height:100%;
      z-index:-1;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
    }
    .card{
      padding:32px;border-radius:18px;
      background:rgba(255,255,255,0.05);
      text-align:center;backdrop-filter:blur(6px);
    }
    .logo{width:100px;height:100px;margin:0 auto 12px}
    .logo img{width:100%;height:100%;object-fit:cover;border-radius:16px}
    #count{
      font-size:80px;font-weight:800;
      background:-webkit-linear-gradient(90deg,#fff,#d1e9ff);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    .sub{color:var(--muted);margin-top:4px}
  </style>
</head>
<body>
  <canvas id="fireworks"></canvas>

  <main class="card">
    <div class="logo"><img src="https://powershell-lv2.github.io/splashog.png" alt="logo" /></div>
    <div>‡∏¢‡∏≠‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå Right Now</div>
    <div id="count">0</div>
    <div id="status" class="sub">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>
  </main>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAtrUH_z4CtGcEBpi74Voag1cBhxaKJ1iE",
      authDomain: "powershell-lv2.firebaseapp.com",
      databaseURL: "https://powershell-lv2-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "powershell-lv2",
      storageBucket: "powershell-lv2.firebasestorage.app",
      messagingSenderId: "898177019579",
      appId: "1:898177019579:web:3f24c39da76a166f6cc39e",
      measurementId: "G-BKFJE32QNL"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const countEl = document.getElementById('count');
    const statusEl = document.getElementById('status');

    // auth anonymous
    auth.signInAnonymously().catch(err=>{
      console.error('Auth error',err);
      statusEl.textContent = 'Auth error';
    });

    // presence handling
    const connectedRef = db.ref(".info/connected");
    const presListRef = db.ref("presence");
    let myPresRef = null;
    connectedRef.on("value", snap => {
      if (snap.val() === true) {
        myPresRef = presListRef.push();
        myPresRef.onDisconnect().remove();
        myPresRef.set({ at: firebase.database.ServerValue.TIMESTAMP });
      }
    });

    // live count update (‡∏´‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏°‡∏≠)
    presListRef.on("value", snap => {
      const val = snap.val() || {};
      let count = Object.keys(val).length;
      if (count > 0) count -= 1; // ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏≠‡∏Å

      countEl.textContent = count.toLocaleString();
      statusEl.textContent = count === 0 
        ? "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ"
        : `‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${count} ‡∏Ñ‡∏ô`;
    });

    // ---------------------------
    // Fireworks Effect üéÜ
    // ---------------------------
    const canvas=document.getElementById('fireworks');
    const ctx=canvas.getContext('2d');
    let W,H;
    function resize(){
      W=canvas.width=window.innerWidth;
      H=canvas.height=window.innerHeight;
    }
    resize();
    window.addEventListener('resize',resize);

    class Particle{
      constructor(x,y,hue){
        this.x=x;this.y=y;
        const angle=Math.random()*2*Math.PI;
        const speed=Math.random()*6+2;
        this.vx=Math.cos(angle)*speed;
        this.vy=Math.sin(angle)*speed;
        this.life=0;
        this.hue=hue;
        this.alpha=1;
      }
      update(){
        this.x+=this.vx;
        this.y+=this.vy;
        this.vy+=0.05;
        this.vx*=0.98;this.vy*=0.98;
        this.life++;
        this.alpha-=0.008;
      }
      draw(){
        ctx.fillStyle=`hsla(${this.hue},100%,60%,${this.alpha})`;
        ctx.beginPath();
        ctx.arc(this.x,this.y,2,0,Math.PI*2);
        ctx.fill();
      }
    }

    const particles=[];
    function explode(x,y){
      const hue=Math.random()*360;
      for(let i=0;i<200;i++){ // 200 ‡∏î‡∏ß‡∏á‡∏ï‡πà‡∏≠‡∏û‡∏•‡∏∏
        particles.push(new Particle(x,y,hue));
      }
    }

    // ‡∏™‡∏∏‡πà‡∏°‡∏¢‡∏¥‡∏á‡∏û‡∏•‡∏∏‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
    setInterval(()=>{
      for(let i=0;i<3;i++){ // ‡∏ó‡∏µ‡∏•‡∏∞ 3 ‡∏à‡∏∏‡∏î
        explode(Math.random()*W*0.9+W*0.05, Math.random()*H*0.6+H*0.1);
      }
    },1000);

    function loop(){
      ctx.fillStyle="rgba(15,23,42,0.2)"; // fade background
      ctx.fillRect(0,0,W,H);
      for(let i=particles.length-1;i>=0;i--){
        const p=particles[i];
        p.update();p.draw();
        if(p.alpha<=0)particles.splice(i,1);
      }
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
